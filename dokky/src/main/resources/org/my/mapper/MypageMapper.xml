<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.my.mapper.MypageMapper">
	
	<!-- 나의 정보 한줄 가져오기 -->
	 <select id="getMyInfo" resultType="org.my.domain.MemberVO">
		select * from DK_MEMBER where userId = #{userId}
	</select>
	
	<!-- 나의 정보 변경하기 -->
	<update id="updateMyInfo">
		update DK_MEMBER set 
			nickName = #{nickName},
			email 	 = #{email},
			phoneNum = #{phoneNum},
			bankName = #{bankName},
			account  = #{account}
	  where userId   = #{userId}
	</update>
	
	<!-- 비밀번호 가져오기 --> 
	 <select id="getMemberPW" resultType="String">
		select userpw from DK_MEMBER where userId = #{userId}
	</select>
	
	<!-- 비밀번호 변경 -->
	<update id="updateMyPassword">
		update DK_MEMBER set userpw = #{userPw} where userId = #{userId}
	</update>
	
	<select id="getMyBoardList" resultType="org.my.domain.BoardVO"> 
	select num,
		   title,
		   replyCnt,
		   hitCnt,
		   category,
		   regdate from 
			 ( select /*+INDEX_DESC(DK_BOARD PK_DK_BOARD) */ rownum rn,
			 														num,
			 														title,
			 														replyCnt,
			 														hitCnt,
			 														category,
			 														regdate
			from DK_BOARD where userId = #{userId} and <![CDATA[ rownum <= #{pageNum} * #{amount} )
				  where rn > (#{pageNum} -1) * #{amount}  
				  ]]>
	</select>
	
	<select id="getMyBoardCount" resultType="int">
		select count(*) from DK_BOARD where userId = #{userId} and num > 0
	</select>
	
	<select id="getMyReplylist" resultType="org.my.domain.ReplyVO">
	  <![CDATA[
		 select reply_num, num, reply_content, userId, replydate
		 from 
		   (
		    select /*+INDEX_DESC(DK_REPLY pk_reply) */ 
		      rownum rn, reply_num, num, reply_content, userId, replydate
		    from DK_REPLY
		    where userId = #{userId}
		    and reply_num > 0
		    and rownum <= #{pageNum} * #{amount}
		   ) where rn > (#{pageNum} -1) * #{amount}
	  ]]>
	</select>
	
	<select id="getMyReplyCount" resultType="int">
		<![CDATA[
		select count(reply_num) from DK_REPLY where userId = #{userId} and reply_num > 0
		]]>
	</select>
	
</mapper>
