<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.my.mapper.AdminMapper">
	<select id="getCashRequest" resultType="org.my.domain.cashVO"> 
	
		select cash_num,
			   regDate,
			   cashAmount,
			   specification,
			   userId,
			   cashKind
			   from 
				 ( select /*+INDEX_DESC(dk_cash pk_cash) */ rownum rn,
				 											  cash_num,
															   regDate,
															   cashAmount,
															   specification,
															   userId,
															   cashKind
				from dk_cash where (specification = '승인중' or specification = '승인완료') and <![CDATA[ rownum <= #{pageNum} * #{amount} )
					  where rn > (#{pageNum} -1) * #{amount}  
					  ]]>
	</select>
	
	<update id="updateApprove">
		update dk_cash set specification = '승인완료' where cash_num = #{cash_num} 
	</update>
	
	<select id="getTotalCount" resultType="int">
		select count(*) from dk_cash where specification = '승인중' or specification = '승인완료'
	</select>
	
	<update id="updatePluscash">
	    update dk_member set cash = cash + #{cashAmount} where userId = #{userId}
	</update>
	
	<update id="updateMinuscash">
	    update dk_member set cash = cash - #{cashAmount} where userId = #{userId}
	</update>
	
	
	<sql id="criteria">
		<trim prefix="where" suffix="" prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'I'.toString()">
							userId like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'N'.toString()">
						 	nickName like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>
	
	 <select id="getMemberList" resultType="org.my.domain.MemberVO">
		select * from DK_MEMBER  <include refid ="criteria"></include>  
				
	</select>
	  
	<select id="getMemberTotalCount" resultType="int">
		select count(*) from dk_member <include refid ="criteria"></include>  
				
	</select>
	
</mapper>
